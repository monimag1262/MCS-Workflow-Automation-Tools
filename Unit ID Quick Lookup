Problem:
When working a case or reviewing fleet data, you often need to check a unit's location across multiple systems â€” Fleet Monitoring, Relay Garage, and YMS. Each lookup requires navigating to a different tool and manually entering the same information.

Original Process Requires:
Copying the Unit ID from the case or table
Opening Fleet Monitoring in a new tab
Pasting the Unit ID into the search field
Repeating for Relay Garage if you need work order history
Opening YMS separately to verify if the trailer is actually at the reported location
Manually selecting the site from a dropdown
Typing the Unit ID into the search field
If the site isn't in the dropdown, trying alternate sites one by one
This is repetitive, slow, and pulls you out of your workflow constantly.

Solution:
I built a script that adds quick-action buttons and automates cross-system lookups â€” including auto-filling YMS with Unit ID and site code extracted from the source page.

What the Script Does:
1. Adds quick links (Paragon)	Inserts "Unit Location" and "Relay Garage" buttons that auto-populate the Unit ID
2. Converts Yes/No to buttons (Fleet Monitoring)	Turns static "Yes/No" loaded status into clickable "Check YMS" buttons
3. Extracts Unit ID	Reads the Unit ID from the row (via asset links or cell content)
4. Extracts site codes	Pulls primary and alternate site codes from the row
5. Stores values	Saves Unit ID and site codes for the next page
6. Opens YMS	Launches YMS in a new tab
7. Auto-fills YMS	Populates the search field and site dropdown automatically
8. Handles fallback	If primary site isn't in the dropdown, tries alternate sites automatically

Impact:
One-click lookups â€” No more copy/paste/navigate/paste
Cross-system automation â€” Data flows from Fleet Monitoring to YMS seamlessly
Smarter site handling â€” Automatically tries alternate locations if primary fails
Faster verification â€” Confirm trailer location in seconds instead of minutes
Embedded in workflow â€” Buttons appear right where you're already working

Script: 
// ==UserScript==
// @name         Paragon Quick Links + YMS Integration
// @namespace    http://tampermonkey.net/
// @version      2.3
// @description  Add quick navigation buttons for Unit Location, Relay Garage, and YMS verification
// @author       monimag
// @match        https://paragon-na.amazon.com/hz/view-case?caseId=*
// @match        https://aap-na.corp.amazon.com/page/dfd44913-d2f4-4e96-99e2-64729dbdc19a*
// @match        https://trans-logistics.amazon.com/yms/shipclerk/*
// @grant        GM_setValue
// @grant        GM_getValue
// ==/UserScript==

(function() {
    'use strict';

    // ========================================
    // UTILITY FUNCTIONS
    // ========================================

    function showToast(message, type = "info") {
        const toast = document.createElement('div');
        toast.textContent = message;

        const colors = {
            info: '#0073bb',
            success: '#067d62',
            warning: '#f08804',
            error: '#d13212'
        };

        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: ${colors[type] || colors.info};
            color: white;
            padding: 15px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            z-index: 10000;
            font-size: 14px;
            font-weight: bold;
            max-width: 300px;
            animation: slideIn 0.3s ease-out;
        `;

        document.body.appendChild(toast);

        setTimeout(() => {
            toast.style.animation = 'slideOut 0.3s ease-out';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    // Add animation styles
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }
    `;
    document.head.appendChild(style);

    // ========================================
    // YMS FUNCTIONS
    // ========================================

    function isValidUnitId(text) {
        // Remove whitespace
        text = text.trim();

        // Must be between 5-10 characters
        if (text.length < 5 || text.length > 10) return false;

        // Must contain at least one letter and one number
        const hasLetter = /[A-Z]/i.test(text);
        const hasNumber = /\d/.test(text);
        if (!hasLetter || !hasNumber) return false;

        // Must be alphanumeric only
        if (!/^[A-Z0-9]+$/i.test(text)) return false;

        // Exclude common non-unit-ID patterns
        const excludePatterns = [
            /^(YES|NO)$/i,
            /^\d{1,2}\/\d{1,2}\/\d{2}$/,  // dates
            /^PS\d{3}$/,  // PS codes like PS906
            /^[A-Z]{3,5}\d{1,2}$/  // site codes like TUL5, ILG1
        ];

        for (const pattern of excludePatterns) {
            if (pattern.test(text)) return false;
        }

        return true;
    }

    function isValidSiteCode(text) {
        text = text.trim();

        // Site codes are typically 3-5 letters followed by 0-2 digits
        // Examples: TUL5, ILG1, XMT2, DSR4
        if (!/^[A-Z]{3,5}\d{0,2}$/i.test(text)) return false;

        // Exclude Yes/No
        if (text === 'Yes' || text === 'No') return false;

        // Must be at least 3 characters
        if (text.length < 3) return false;

        return true;
    }

    function extractUnitIdFromRow(button) {
        const row = button.closest('tr');
        if (!row) {
            console.log('âŒ Could not find parent row');
            return null;
        }

        console.log('ðŸ” Searching for Unit ID in row...');

        // Priority 1: Look for link with href="/v2/asset/" - this is most reliable
        const assetLinks = row.querySelectorAll('a[href*="/v2/asset/"]');
        console.log(`Found ${assetLinks.length} asset link(s)`);

        for (const link of assetLinks) {
            const text = link.textContent.trim();
            console.log(`  Checking asset link: "${text}"`);

            if (isValidUnitId(text)) {
                console.log(`  âœ… VALID Unit ID found: ${text}`);
                return text.toUpperCase();
            }
        }

        // Priority 2: Look in the second cell (typical position for unit ID)
        const cells = row.querySelectorAll('td');
        if (cells.length > 1) {
            const secondCell = cells[1];
            const secondCellText = secondCell.textContent.trim();
            console.log(`  Checking 2nd cell: "${secondCellText}"`);

            if (isValidUnitId(secondCellText)) {
                console.log(`  âœ… VALID Unit ID found in 2nd cell: ${secondCellText}`);
                return secondCellText.toUpperCase();
            }
        }

        // Priority 3: Check all cells for any valid unit ID
        console.log(`  Checking all ${cells.length} cells...`);
        for (let i = 0; i < cells.length; i++) {
            const cell = cells[i];
            const cellText = cell.textContent.trim();

            // Skip empty cells and cells with just "--"
            if (!cellText || cellText === '--') continue;

            console.log(`  Cell ${i}: "${cellText}"`);

            if (isValidUnitId(cellText)) {
                console.log(`  âœ… VALID Unit ID found in cell ${i}: ${cellText}`);
                return cellText.toUpperCase();
            }
        }

        console.log('âŒ No valid Unit ID found in row');
        return null;
    }

    function extractSiteCodeFromRow(button) {
        const row = button.closest('tr');
        if (!row) {
            console.log('âŒ Could not find parent row');
            return [];
        }

        console.log('ðŸ” Searching for site codes in row...');

        const siteCodes = [];
        const cells = row.querySelectorAll('td');

        // Look through all cells
        for (let i = 0; i < cells.length; i++) {
            const cell = cells[i];

            // Check paragraphs in the cell
            const paragraphs = cell.querySelectorAll('p');
            for (const p of paragraphs) {
                const text = p.textContent.trim();

                // Skip empty or placeholder text
                if (!text || text === '--') continue;

                console.log(`  Cell ${i} paragraph: "${text}"`);

                // Check if this contains multiple sites separated by comma
                if (text.includes(',')) {
                    const sites = text.split(',').map(s => s.trim());
                    console.log(`    Found comma-separated values: ${sites.join(', ')}`);

                    for (const site of sites) {
                        if (isValidSiteCode(site)) {
                            siteCodes.push(site.toUpperCase());
                            console.log(`    âœ… Valid site code: ${site}`);
                        }
                    }
                } else {
                    // Single value
                    if (isValidSiteCode(text)) {
                        siteCodes.push(text.toUpperCase());
                        console.log(`    âœ… Valid site code: ${text}`);
                    }
                }
            }

            // Also check links in the cell (some sites might be in links)
            const links = cell.querySelectorAll('a');
            for (const link of links) {
                const text = link.textContent.trim();

                if (!text || text === '--') continue;

                if (text.includes(',')) {
                    const sites = text.split(',').map(s => s.trim());
                    for (const site of sites) {
                        if (isValidSiteCode(site) && !siteCodes.includes(site.toUpperCase())) {
                            siteCodes.push(site.toUpperCase());
                            console.log(`    âœ… Valid site code from link: ${site}`);
                        }
                    }
                } else {
                    if (isValidSiteCode(text) && !siteCodes.includes(text.toUpperCase())) {
                        siteCodes.push(text.toUpperCase());
                        console.log(`    âœ… Valid site code from link: ${text}`);
                    }
                }
            }
        }

        console.log(`ðŸ“ Total site codes found: ${siteCodes.length} - [${siteCodes.join(', ')}]`);
        return siteCodes;
    }

    function handleCheckYMS(button) {
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('ðŸš€ YMS Check Started');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

        const unitId = extractUnitIdFromRow(button);
        const siteCodes = extractSiteCodeFromRow(button);

        console.log('ðŸ“Š Extraction Results:');
        console.log(`   Unit ID: ${unitId || 'NOT FOUND'}`);
        console.log(`   Site Codes: ${siteCodes.length > 0 ? siteCodes.join(', ') : 'NOT FOUND'}`);
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

        if (!unitId) {
            showToast("Could not find Unit ID in this row!", "error");
            console.error('âŒ Unit ID extraction failed');
            return;
        }

        if (!siteCodes || siteCodes.length === 0) {
            showToast("Could not find Location Code! Opening YMS without auto-fill.", "warning");
            GM_setValue('yms_unitId', unitId);
            GM_setValue('yms_locationCode', '');
            GM_setValue('yms_alternateSites', JSON.stringify([]));
            window.open('https://trans-logistics.amazon.com/yms/shipclerk/?state=%2Fyms%2Fshipclerk%2F#/yard', '_blank');
            return;
        }

        // Store primary site and alternates
        const primarySite = siteCodes[0];
        const alternateSites = siteCodes.slice(1);

        GM_setValue('yms_unitId', unitId);
        GM_setValue('yms_locationCode', primarySite);
        GM_setValue('yms_alternateSites', JSON.stringify(alternateSites));

        console.log('ðŸ’¾ Stored values:');
        console.log(`   Unit ID: ${unitId}`);
        console.log(`   Primary Site: ${primarySite}`);
        console.log(`   Alternate Sites: ${alternateSites.join(', ') || 'none'}`);

        const siteInfo = alternateSites.length > 0
            ? `${primarySite} (${alternateSites.length} alternate${alternateSites.length > 1 ? 's' : ''})`
            : primarySite;

        showToast(`Opening YMS\nUnit: ${unitId}\nSite: ${siteInfo}`, "success");

        window.open('https://trans-logistics.amazon.com/yms/shipclerk/?state=%2Fyms%2Fshipclerk%2F#/yard', '_blank');
    }

    // ========================================
    // YMS PAGE AUTO-FILL (Angular-based)
    // ========================================

    function autoFillYMS() {
        const unitId = GM_getValue('yms_unitId', '');
        const locationCode = GM_getValue('yms_locationCode', '');
        const alternateSitesJson = GM_getValue('yms_alternateSites', '[]');

        let alternateSites = [];
        try {
            alternateSites = JSON.parse(alternateSitesJson);
        } catch (e) {
            console.error('Error parsing alternate sites:', e);
        }

        if (!unitId && !locationCode) {
            console.log('No stored values for YMS auto-fill');
            return;
        }

        console.log('YMS Auto-fill starting with:', {
            unitId,
            locationCode,
            alternateSites
        });

        let attempts = 0;
        const maxAttempts = 20;
        let currentSiteIndex = 0;
        let currentSite = locationCode;

        const fillAttempt = function() {
            attempts++;
            console.log(`YMS Auto-fill attempt ${attempts}/${maxAttempts} with site: ${currentSite}`);

            const searchInput = document.getElementById('searchInput');
            const dropdown = document.querySelector('select[ng-model="$root.selectedYardSite"]');

            if (searchInput && dropdown && unitId && currentSite) {
                console.log('âœ… Found all elements, filling now...');

                setTimeout(() => {
                    // Fill search input
                    searchInput.value = unitId;
                    searchInput.dispatchEvent(new Event('input', { bubbles: true }));
                    searchInput.dispatchEvent(new Event('change', { bubbles: true }));
                    console.log('âœ… Filled search input with:', unitId);

                    // Check if the site exists in dropdown
                    const siteOption = dropdown.querySelector(`option[value="string:${currentSite}"]`);

                    if (!siteOption && currentSiteIndex < alternateSites.length) {
                        // Try alternate site
                        console.log(`âš ï¸ Site ${currentSite} not found in dropdown, trying alternate...`);
                        currentSiteIndex++;
                        currentSite = alternateSites[currentSiteIndex - 1];

                        showToast(`Primary site not available, trying: ${currentSite}`, 'warning');

                        // Restart with new site
                        attempts = 0;
                        setTimeout(fillAttempt, 1000);
                        return;
                    }

                    // Fill dropdown
                    dropdown.value = 'string:' + currentSite;
                    dropdown.dispatchEvent(new Event('change', { bubbles: true }));
                    console.log('âœ… Filled dropdown with:', currentSite);

                    // Try Angular scope manipulation
                    try {
                        if (typeof angular !== 'undefined') {
                            let searchScope = angular.element(searchInput).scope();
                            let dropdownScope = angular.element(dropdown).scope();

                            if (searchScope) {
                                searchScope.$apply(function() {
                                    searchScope.topbar.filters.searchQuery = unitId;
                                    if (typeof searchScope.topbar.textSearch === 'function') {
                                        searchScope.topbar.textSearch(unitId);
                                    }
                                });
                                console.log('âœ… Applied Angular scope for search');
                            }

                            if (dropdownScope) {
                                dropdownScope.$apply(function() {
                                    dropdownScope.$root.selectedYardSite = currentSite;
                                    if (typeof dropdownScope.refreshFunction === 'function') {
                                        dropdownScope.refreshFunction();
                                    }
                                });
                                console.log('âœ… Applied Angular scope for dropdown');
                            }
                        }
                    } catch (e) {
                        console.error('âŒ YMS Auto-fill Angular error:', e);
                    }

                    // Clear stored values
                    GM_setValue('yms_unitId', '');
                    GM_setValue('yms_locationCode', '');
                    GM_setValue('yms_alternateSites', '[]');
                    console.log('âœ… Cleared stored values');

                    const usedAlternate = currentSite !== locationCode;
                    showToast(
                        usedAlternate
                            ? `YMS filled with alternate site: ${currentSite}`
                            : 'YMS fields auto-filled!',
                        'success'
                    );

                }, 1000);

                return true; // Success
            }

            if (attempts >= maxAttempts) {
                console.log('âŒ YMS Auto-fill: Timeout after ' + maxAttempts + ' attempts');

                // Clear stored values even on timeout
                GM_setValue('yms_unitId', '');
                GM_setValue('yms_locationCode', '');
                GM_setValue('yms_alternateSites', '[]');
                return true; // Stop trying
            }

            // Try again
            setTimeout(fillAttempt, 1000);
            return false;
        };

        fillAttempt();
    }

    // ========================================
    // CONVERT "YES/NO" TO YMS BUTTON
    // ========================================

    function convertLoadedStatusToButton() {
        // Find all paragraphs that might contain "Yes" or "No"
        const statusParagraphs = document.querySelectorAll('p.css-1ndm675, p.css-p6zxe3, p[mdn-text]');

        for (const p of statusParagraphs) {
            const text = p.textContent.trim();

            if (text === 'Yes' || text === 'No') {
                // Check if already converted
                if (p.dataset.ymsConverted) continue;

                // Mark as converted
                p.dataset.ymsConverted = 'true';

                // Get the parent cell
                const cell = p.closest('td.css-18tzy6q');
                if (!cell) continue;

                // Create button
                const button = document.createElement('button');
                button.textContent = `${text} - Check YMS`;
                button.style.cssText = `
                    padding: 6px 12px;
                    background-color: ${text === 'Yes' ? '#067d62' : '#d13212'};
                    color: white;
                    border: none;
                    border-radius: 4px;
                    font-size: 13px;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s;
                    width: 100%;
                `;

                button.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = text === 'Yes' ? '#045d47' : '#a02a0f';
                    this.style.transform = 'scale(1.05)';
                });

                button.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = text === 'Yes' ? '#067d62' : '#d13212';
                    this.style.transform = 'scale(1)';
                });

                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('ðŸ–±ï¸ YMS button clicked');
                    handleCheckYMS(this);
                });

                // Replace the paragraph with the button
                p.replaceWith(button);
                console.log(`âœ… Converted "${text}" to YMS button`);
            }
        }
    }

    // ========================================
    // PARAGON PAGE FUNCTIONS
    // ========================================

    function getUnitId() {
        const bodyText = document.body.innerText;
        const unitIdMatch = bodyText.match(/\b\d{6}\b/);
        if (unitIdMatch) {
            return unitIdMatch[0];
        }
        return prompt("Enter Unit ID (e.g., 001174):");
    }

    function createButton(text, clickHandler) {
        const button = document.createElement('button');
        button.textContent = text;
        button.style.cssText = `
            display: block;
            width: 100%;
            padding: 10px 15px;
            margin: 5px 0;
            background-color: #FF9900;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        `;

        button.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#E88B00';
        });

        button.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '#FF9900';
        });

        button.addEventListener('click', clickHandler);

        return button;
    }

    function insertButtons() {
        const targetElement = document.querySelector('[data-test="render-to-child"]');

        if (!targetElement) {
            console.log('Target element not found, retrying...');
            setTimeout(insertButtons, 1000);
            return;
        }

        if (document.getElementById('custom-quick-links-container')) {
            return;
        }

        const buttonContainer = document.createElement('div');
        buttonContainer.id = 'custom-quick-links-container';
        buttonContainer.style.cssText = `
            padding: 15px;
            margin: 10px 0;
            background-color: #f3f3f3;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        `;

        const header = document.createElement('h3');
        header.textContent = 'Quick Links';
        header.style.cssText = `
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #232F3E;
        `;
        buttonContainer.appendChild(header);

        const fleetButton = createButton('Unit Location - Fleet Monitoring', function() {
            const unitId = getUnitId();
            if (unitId) {
                const baseUrl = 'https://aap-na.corp.amazon.com/page/dfd44913-d2f4-4e96-99e2-64729dbdc19a?map-layout=SPLIT&states=%5B%7B%22state%22%3A%22ACTIVE%22%2C%22reasons%22%3A%5B%5D%7D%2C%7B%22state%22%3A%22UNAVAILABLE%22%2C%22reasons%22%3A%5B%5D%7D%5D&fields=%5B%5D&fleets=%5B%220f454f75-1e45-475f-8d8b-2334ade1f6f1%22%2C%227de393df-74e1-45af-9650-560ba008bc65%22%2C%22b84ddc20-589c-4330-af67-3d38f89e28af%22%2C%22b9e02fc4-2b9f-4a70-ac7c-76b30a33bcbe%22%2C%22ba97eda1-cb03-446e-a907-474084194777%22%2C%22daa83ad7-5d8f-43a4-ba9c-76c643e45e1e%22%5D&operationalStatuses=%5B%5D&geofences=%7B%22type%22%3A%22ANYWHERE%22%2C%22customGeofences%22%3A%5B%5D%7D&stationCodes=%5B%5D&dspShortCodes=%5B%5D&flags=%7B%7D&domicileSites=%5B%5D';
                const fullUrl = baseUrl + '&search=' + unitId;
                window.open(fullUrl, '_blank');
            }
        });

        const relayButton = createButton('Relay Garage Work Orders', function() {
            const unitId = getUnitId();
            if (unitId) {
                const baseUrl = 'https://aap-na.corp.amazon.com/page/817ca098-8441-4329-a71e-6768f9d7e6c5?tab=Unplanned';
                const fullUrl = baseUrl + '&ids=' + unitId;
                window.open(fullUrl, '_blank');
            }
        });

        buttonContainer.appendChild(fleetButton);
        buttonContainer.appendChild(relayButton);

        targetElement.parentNode.insertBefore(buttonContainer, targetElement.nextSibling);

        console.log('Quick Links buttons added successfully!');
    }

    // ========================================
    // MAIN EXECUTION
    // ========================================

    function init() {
        const currentUrl = window.location.href;
        console.log('Script initialized on:', currentUrl);

        // If on Paragon page, add quick link buttons
        if (currentUrl.includes('paragon-na.amazon.com')) {
            console.log('On Paragon page - adding quick links');
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', insertButtons);
            } else {
                insertButtons();
            }
            setTimeout(insertButtons, 2000);
        }

        // If on Fleet Monitoring page, convert Yes/No to YMS buttons
        if (currentUrl.includes('aap-na.corp.amazon.com/page/dfd44913')) {
            console.log('On Fleet Monitoring page - converting Yes/No to buttons');

            // Initial conversion
            setTimeout(convertLoadedStatusToButton, 1000);
            setTimeout(convertLoadedStatusToButton, 2000);
            setTimeout(convertLoadedStatusToButton, 3000);

            // Watch for dynamic content changes
            const observer = new MutationObserver(() => {
                convertLoadedStatusToButton();
            });

            observer.observe(document.body, {
                childList: true,
                subtree: true
            });

            // Periodic check for dynamically loaded content
            setInterval(convertLoadedStatusToButton, 2000);
        }

        // If on YMS page, auto-fill fields
        if (currentUrl.includes('trans-logistics.amazon.com/yms/shipclerk')) {
            console.log('On YMS page - attempting auto-fill');

            // Multiple attempts at different times
            setTimeout(autoFillYMS, 1000);
            setTimeout(autoFillYMS, 2000);
            setTimeout(autoFillYMS, 3000);

            window.addEventListener('load', autoFillYMS);
        }
    }

    // Start the script
    init();
})();
